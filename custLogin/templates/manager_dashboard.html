{% extends "base.html" %}
{% block title %}Manager Dashboard{% endblock %}

{% block content %}
    <style>
        .customer-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            position: relative;
        }

        .customer-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .customer-card.locked {
            border-left: 4px solid #dc3545;
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.05), rgba(255, 255, 255, 1));
        }

        .customer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 1rem auto;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
        }

        .customer-avatar.locked {
            background: linear-gradient(135deg, #dc3545 0%, #6c757d 100%);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .customer-avatar.locked::after {
            content: '\f023';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            border: 2px solid white;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: rgba(248, 249, 250, 0.5);
            border-radius: 10px;
        }

        .info-icon {
            width: 20px;
            margin-right: 0.75rem;
            color: #6c757d;
        }

        .balance-highlight {
            font-weight: bold;
            font-size: 1.1rem;
            color: #28a745;
        }

        .btn-modern {
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .status-badges {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }

        .lock-status {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .lock-status .badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 1;
            }
        }

        .btn-lock {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
        }

        .btn-lock:hover {
            background: linear-gradient(135deg, #c82333, #dc3545);
            color: white;
            transform: translateY(-2px);
        }

        .btn-unlock {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
        }

        .btn-unlock:hover {
            background: linear-gradient(135deg, #20c997, #28a745);
            color: white;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .action-buttons .btn {
            font-size: 0.8rem;
            padding: 0.5rem;
        }

        .lock-unlock-section {
            grid-column: span 2;
            margin-top: 0.5rem;
        }

        .badge.bg-danger {
            font-size: 0.7rem;
            animation: pulse-notification 2s infinite;
        }

        @keyframes pulse-notification {
            0% {
                transform: scale(1) translate(-50%, -50%);
            }
            50% {
                transform: scale(1.1) translate(-50%, -50%);
            }
            100% {
                transform: scale(1) translate(-50%, -50%);
            }
        }
    </style>

    <div class="bg-white rounded-4 shadow-sm p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">üìã Your Customers</h2>
            <a href="{% url 'manager_chat_list' %}" class="btn btn-info position-relative">
                <i class="fas fa-comments me-2"></i>Live Chat Support
                {% if total_unread_count > 0 %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            {{ total_unread_count }}
            <span class="visually-hidden">unread messages</span>
        </span>
                {% endif %}
            </a>
        </div>

        <form method="get" class="d-flex mb-3 flex-column flex-md-row gap-2 justify-content-center">
            <input type="text" name="q" placeholder="Search customers..."
                   class="form-control w-100 w-md-50 rounded-3" value="{{ request.GET.q }}">
            <button type="submit" class="btn btn-outline-primary rounded-3">üîç Search</button>
        </form>
    </div>

    <div class="row g-4">
        {% for customer in customers %}
            <div class="col-lg-4 col-md-6">
                <div class="customer-card {% if customer.is_locked %}locked{% endif %} p-4 h-100">
                    {% if customer.is_locked %}
                        <div class="lock-status">
                <span class="badge bg-danger">
                    <i class="fas fa-lock me-1"></i>Locked
                </span>
                        </div>
                    {% endif %}

                    <div class="text-center mb-3">
                        <div class="customer-avatar {% if customer.is_locked %}locked{% endif %}">
                            üë§
                        </div>
                        <h5 class="mb-2">{{ customer.username }}</h5>

                        <div class="status-badges">
                            {% if customer.is_locked %}
                                <span class="badge bg-danger rounded-pill">üîí Account Locked</span>
                            {% else %}
                                {% if customer.can_cashout %}
                                    <span class="badge bg-success rounded-pill">‚úÖ Eligible</span>
                                {% else %}
                                    <span class="badge bg-warning text-dark rounded-pill">‚è≥ Pending</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    <div class="customer-info">
                        <div class="info-item">
                            <i class="fas fa-envelope info-icon"></i>
                            <span class="text-truncate">{{ customer.email }}</span>
                        </div>

                        <div class="info-item">
                            <i class="fas fa-phone info-icon"></i>
                            <span>{{ customer.phone }}</span>
                        </div>

                        <div class="info-item">
                            <i class="fas fa-dollar-sign info-icon"></i>
                            <span class="balance-highlight">${{ customer.balance }}</span>
                        </div>

                        {% if customer.is_locked and customer.locked_at %}
                            <div class="info-item">
                                <i class="fas fa-clock info-icon"></i>
                                <small class="text-muted">Locked: {{ customer.locked_at }}</small>
                            </div>
                        {% endif %}
                    </div>

                    <div class="action-buttons">
                        <a href="{% url 'edit_customer' customer.id %}" class="btn btn-warning btn-sm btn-modern">
                            ‚úèÔ∏è Edit
                        </a>
                        <a href="{% url 'view_customer' customer.id %}" class="btn btn-info btn-sm btn-modern">
                            üëÅ View
                        </a>
                        <a href="{% url 'delete_customer' customer.id %}" class="btn btn-danger btn-sm btn-modern"
                           onclick="return confirm('Delete this customer?');">
                            üóë Delete
                        </a>

                        <div class="lock-unlock-section">
                            {% if customer.is_locked %}
                                <a href="{% url 'unlock_customer' customer.id %}"
                                   class="btn btn-unlock btn-sm btn-modern w-100"
                                   onclick="return confirm('Are you sure you want to unlock {{ customer.username }}?');">
                                    <i class="fas fa-unlock me-1"></i>Unlock Account
                                </a>
                            {% else %}
                                <a href="{% url 'lock_customer' customer.id %}"
                                   class="btn btn-lock btn-sm btn-modern w-100">
                                    <i class="fas fa-lock me-1"></i>Lock Account
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="text-center p-5 bg-white rounded-4 shadow-sm">
                    <i class="fas fa-users mb-3" style="font-size: 4rem; color: #dee2e6;"></i>
                    <h4>No customers found</h4>
                    <p class="text-muted">Try adjusting your search criteria or add a new customer.</p>
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}